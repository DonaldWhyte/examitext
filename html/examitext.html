<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<title>Examitext</title>

	<!-- External libraries -->
	<script type="text/javascript" src="../js/jquery-1.6.2.js"></script>
	<script type="text/javascript" src="../js/highcharts.js"></script>
	<script type="text/javascript" src="../js/snowball.js"></script>
	<script type="text/javascript" src="../js/htmlparser.js"></script>
	<script type="text/javascript" src="../js/split.js"></script>

	<!-- Examitext Files -->
	<script type="text/javascript" src="../js/highcharts_wrapper.js"></script>

	<script type="text/javascript" src="../js/util.js"></script>
	<script type="text/javascript" src="../js/taskqueue.js"></script>

	<script type="text/javascript" src="../js/sanitiser.js"></script>
	<script type="text/javascript" src="../js/stemmer.js"></script>
	<script type="text/javascript" src="../js/stoplist.js"></script>
	<script type="text/javascript" src="../js/document_processor.js"></script>
	<script type="text/javascript" src="../js/log_processor.js"></script>

	<script type="text/javascript" src="../js/tokeniser.js"></script>
	<script type="text/javascript" src="../js/code_processor.js"></script>

	<script type="text/javascript" src="../js/displayer.js"></script>
	<script type="text/javascript">

	/* Useful for dynamically placing elements at the centre of the screen. */
	jQuery.fn.center_x = function() {
		this.css("position","absolute");
		this.css("left", (($(window).width() - this.outerWidth()) / 2) + $(window).scrollLeft() + "px");
	}
	jQuery.fn.center_y = function() {
		this.css("position","absolute");
		this.css("top", (($(window).height() - this.outerHeight()) / 2) + $(window).scrollTop() + "px");
	}
	jQuery.fn.center = function() {
		this.center_x();
		this.center_y();
	    return this;
	}

	// Maps the index of the selected language to its name
	var indexToLanguage = {
		0 : "english",
		1 : "french",
		2 : "german",
		3 : "italian",
		4 : "spanish",
		5 : "portuguese",
		6 : "swedish",
		7 : "finnish"
	}
	// Global variables for this page, store what feature and language have been selected
	var selectedFeature = 0
	var selectedLanguage = 0;
	var selectedProgLanguage = 0;

	/* Retrives text from the raw text area. */
	function getText() {
		var rawText = document.forms("logForm").elements["rawText"];
		return rawText.value;
	}

	/* Called when the analyse button is clicked. */
	function analyse() {
		// Get source text
		var text = getText();
		if (text != undefined && text != "") {
			if (!TaskQueue.instance.running) {
				switch (selectedFeature) {
					case 0: analyseDocument(text); break;
					case 1: analyseChatlog(text); break;
					case 2: analyseSourceFile(text); break;
				}
				$("#buttonContainer").html("<a href='javascript:cancelAnalysis()' class='button'>Cancel</a><br /><br />");
			}
		} else {
			showMessage("No text provided.", 4000);
		}
	}

	function analyseDocument(text) {
		// Creates objects to clean up the text based on the selected language
		var language = indexToLanguage[selectedLanguage];
		var sanitiser = new Sanitiser(language);
		var stemmerObject = new Stemmer(sanitiser, language);
		var stoplist = new Stoplist(STOP_LISTS[language]);

		TaskQueue.instance.add(new DocumentStatistics(text, stemmerObject, stoplist, showMessage));
		TaskQueue.instance.add(new FunctionWrapper(displayDocumentStats));
		TaskQueue.instance.start();
	}

	function analyseChatlog(text) {
		var language = indexToLanguage[selectedLanguage];
		var sanitiser = new Sanitiser(language);
		var stemmerObject = new Stemmer(sanitiser, language);
		var stoplist = new Stoplist(STOP_LISTS[language]);

		TaskQueue.instance.add(new LogProcessor(text, stemmerObject, stoplist, showMessage));
		TaskQueue.instance.add(new ChatStatistics(showMessage));
		TaskQueue.instance.add(new FunctionWrapper(displayChatlogStats));
		TaskQueue.instance.start();	
	}

	function analyseSourceFile(text) {
		switch (selectedProgLanguage) {
		case 0:
			TaskQueue.instance.add(new HTMLStatistics(text, showMessage));
			TaskQueue.instance.add(new FunctionWrapper(displayHTMLStats));
			break;
		case 1:
			TaskQueue.instance.add(new JSStatistics(text, showMessage));
			TaskQueue.instance.add(new FunctionWrapper(displayProgLanguageStats));
			break;
		case 2:
			//TaskQueue.instance.add(new JavaStatistics(text, showMessage));
			TaskQueue.instance.add(new CStyleStatistics(text, showMessage));
			//TaskQueue.instance.add(new FunctionWrapper(displayJavaStats));
			TaskQueue.instance.add(new FunctionWrapper(displayProgLanguageStats));
			break;
		case 3:
			TaskQueue.instance.add(new CSStatistics(text, showMessage));
			TaskQueue.instance.add(new FunctionWrapper(displayCSStats));
			break;
		case 4:
			TaskQueue.instance.add(new CPPStatistics(text, showMessage));
			TaskQueue.instance.add(new FunctionWrapper(displayCPPStats));
			break;
		}
		TaskQueue.instance.start();
	}

	function cancelAnalysis() {
		TaskQueue.instance.stop();

		$("#buttonContainer").html(
			"<a href='javascript:analyse()'' class='button'>Analyse</a><br /><br />");
		// Hides message container then clears its content
		$("#messageContainer").hide("fast").html("");
	}

	function returnToUploader() {
		$("#resultsContainer").hide("fast");
		$("#messageContainer").hide();
		$("#buttonContainer").html("<a href='javascript:analyse()'' class='button'>Analyse</a><br /><br />");
		
		$("#formContainer").show("fast");
	}

	function setFeature(index) {
		previousFeature = selectedFeature;
		selectedFeature = index;
		$("#featureID" + previousFeature).removeClass("selected");
		$("#featureID" + selectedFeature).addClass("selected");

		// Now shows the appropriate form
		if (selectedFeature == 0 || selectedFeature == 1) {
			if (previousFeature != 0 && previousFeature != 1) {
				$("#options1").hide("fast");
				$("#options0").show("fast");
			}
		} else if (selectedFeature == 2) {
			if (previousFeature != 2) {
				$("#options0").hide("fast");
				$("#options1").show("fast");
			}
		}
	}

	function setLanguage(index) {
		$("#languageID" + selectedLanguage).removeClass("selected");
		selectedLanguage = index;
		$("#languageID" + selectedLanguage).addClass("selected");
	}

	function setProgLanguage(index) {
		$("#progLanguageID" + selectedProgLanguage).removeClass("selected");
		selectedProgLanguage = index;
		$("#progLanguageID" + selectedProgLanguage).addClass("selected");
	}

	</script>

	<link rel="stylesheet" type="text/css" href="../css/reset.css" />
	<link rel="stylesheet" type="text/css" href="../css/style.css" />

</head>

<body>

	<div id="container" class="rounded_corners_all">
		<div id="header" class="rounded_corners_top">
			<img src="../images/header.png" alt="Examitext" />
		</div>

		<div id="content">
			<div id="formContainer">
				<div class="featurePadding"></div>
				<a id="featureID0" class="feature selected" href="javascript:setFeature(0)">
				<img src="../images/text_file.png" alt="Text Document" /></a>
				<a id="featureID1" class="feature" href="javascript:setFeature(1)">
				<img src="../images/chat_log.png" alt="Chat Log" /></a>
				<a id="featureID2" class="feature" href="javascript:setFeature(2)">
				<img src="../images/source_file.png" alt="Source File" /></a>
				<div class="featurePadding"></div>

				<form name="logForm" action="#">
					<table>
						<!--<tr><td><strong>Upload File:</strong></td>
						<td><input name="localFile" type="file" onchange="onFileChange()" /></td></tr>
						<tr><td><strong>URL:</strong></tds>
						<td><input name="url" type="text" class="textbox" onchange="onURLChange()" /></td></tr>-->

						<tr><td><strong>Raw text:</strong></td></tr>
						<tr><td><textarea name="rawText" rows="15" cols="150" wrap="off"></textarea></td></tr>
						<tr><td><strong>Language of text:</strong></td></tr>
					</table>
				</form>

				<div id="options0">
					<div class="flagPadding"></div>
					<a id="languageID0" class="language selected" href="javascript:setLanguage(0)" title="English">
					<img src="../images/flags/uk.png" alt="English" /></a>
					<a id="languageID1" class="language" href="javascript:setLanguage(1)" title="Fran&#231;ais">
					<img src="../images/flags/fr.png" alt="Fran&#231;ais" /></a>
					<a id="languageID2" class="language" href="javascript:setLanguage(2)" title="Deutsch">
					<img src="../images/flags/de.png" alt="Deutsch" /></a>
					<a id="languageID3" class="language" href="javascript:setLanguage(3)" title="Italiano">
					<img src="../images/flags/it.png" alt="Italiano" /></a>
					<a id="languageID4" class="language" href="javascript:setLanguage(4)" title="Espa&#241;ol">
					<img src="../images/flags/es.png" alt="Espa&#241;ol" /></a>
					<a id="languageID5" class="language" href="javascript:setLanguage(5)" title="Portugu&#234;s">
					<img src="../images/flags/pt.png" alt="Portugu&#234;s" /></a>
					<a id="languageID6" class="language" href="javascript:setLanguage(6)" title="Svenska">
					<img src="../images/flags/se.png" alt="Svenska" /></a>
					<a id="languageID7" class="language" href="javascript:setLanguage(7)" title="Suomi">
					<img src="../images/flags/fi.png" alt="Suomi" /></a>
					<div class="flagPadding"></div>
				</div>
				<div id="options1">
					<div class="progLanguagePadding"></div>
					<a id="progLanguageID0" class="language selected" href="javascript:setProgLanguage(0)" title="HTML">
					<img src="../images/proglanguages/html.png" alt="HTML" /></a>
					<a id="progLanguageID1" class="language" href="javascript:setProgLanguage(1)" title="JavaScript">
					<img src="../images/proglanguages/js.png" alt="JavaScript" /></a>
					<a id="progLanguageID2" class="language" href="javascript:setProgLanguage(2)" title="Java">
					<img src="../images/proglanguages/java.png" alt="Java" /></a>
					<a id="progLanguageID3" class="language" href="javascript:setProgLanguage(3)" title="C#">
					<img src="../images/proglanguages/cs.png" alt="C#" /></a>
					<a id="progLanguageID4" class="language" href="javascript:setProgLanguage(4)" title="C++">
					<img src="../images/proglanguages/cpp.png" alt="C++" /></a>
					<div class="progLanguagePadding"></div>
				</div>
			</div>

			<!-- Contains messages (typically error messages) to show to the user. -->
			<div id="messageContainer"></div>

			<div style="padding-top: 20px"></div>

			<!-- Empty at the moment, just here so the divs are created. -->
			<div id="resultsContainer"></div>

			<div id="buttonContainer">
				<a href="javascript:analyse()" class="button">Analyse</a>
				<br />
				<br />
			</div>
		</div>

		<div id="footer" class="rounded_corners_bottom">
			<p>Copyright 2011 Donald Whyte</p>
		</div>
	</div>

	<!-- We center the container here since it's been populated with all
	     its content by this point. -->
	<script type="text/javascript">
		$("#container").center();
		$("#messageContainer").hide();
		$("#options1").hide();
	</script>

</body>

</html>
